<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>3 Auto-Add Table Line | Automating Excel</title>
  <meta name="description" content="A guide on how to create automated Excel worksheets and tables">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="3 Auto-Add Table Line | Automating Excel" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide on how to create automated Excel worksheets and tables" />
  <meta name="github-repo" content="NHS-NSS-transforming-publications/automating-excel" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Auto-Add Table Line | Automating Excel" />
  
  <meta name="twitter:description" content="A guide on how to create automated Excel worksheets and tables" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chart-baseline.html">
<link rel="next" href="title-auto-update.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#tips"><i class="fa fa-check"></i>Tips</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="charts-auto-update.html"><a href="charts-auto-update.html"><i class="fa fa-check"></i><b>1</b> Charts Auto-Update</a><ul>
<li class="chapter" data-level="" data-path="charts-auto-update.html"><a href="charts-auto-update.html#steps"><i class="fa fa-check"></i>Steps</a></li>
<li class="chapter" data-level="" data-path="charts-auto-update.html"><a href="charts-auto-update.html#details"><i class="fa fa-check"></i>Details</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chart-baseline.html"><a href="chart-baseline.html"><i class="fa fa-check"></i><b>2</b> Chart Baseline</a><ul>
<li class="chapter" data-level="" data-path="chart-baseline.html"><a href="chart-baseline.html#steps-1"><i class="fa fa-check"></i>Steps</a></li>
<li class="chapter" data-level="" data-path="chart-baseline.html"><a href="chart-baseline.html#details-1"><i class="fa fa-check"></i>Details</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="auto-add-table-line.html"><a href="auto-add-table-line.html"><i class="fa fa-check"></i><b>3</b> Auto-Add Table Line</a><ul>
<li class="chapter" data-level="" data-path="auto-add-table-line.html"><a href="auto-add-table-line.html#steps-2"><i class="fa fa-check"></i>Steps</a></li>
<li class="chapter" data-level="" data-path="auto-add-table-line.html"><a href="auto-add-table-line.html#details-2"><i class="fa fa-check"></i>Details</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="title-auto-update.html"><a href="title-auto-update.html"><i class="fa fa-check"></i><b>4</b> Title Auto-Update</a><ul>
<li class="chapter" data-level="" data-path="title-auto-update.html"><a href="title-auto-update.html#steps-3"><i class="fa fa-check"></i>Steps</a></li>
<li class="chapter" data-level="" data-path="title-auto-update.html"><a href="title-auto-update.html#details-3"><i class="fa fa-check"></i>Details</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Automating Excel</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="auto-add-table-line" class="section level1">
<h1><span class="header-section-number">3</span> Auto-Add Table Line</h1>
<p>Task: to create a new line in an Excel table when new data is added, in this instance quarters.</p>
<div id="steps-2" class="section level2 unnumbered">
<h2>Steps</h2>
<ol style="list-style-type: decimal">
<li>Reference columns within the table need to be calculated from a formula.</li>
<li>Create a VBA script:
<ul>
<li>Check if there are more quarters of data in the data tab</li>
<li>If yes, insert a new row.</li>
</ul></li>
</ol>
</div>
<div id="details-2" class="section level2 unnumbered">
<h2>Details</h2>
<p>In this worked example we are using <a href="https://github.com/NHS-NSS-transforming-publications/automating-excel/raw/master/TableA1b_Automated.xlsm">TableA1b_Automated</a>, with sheets Table1 and DataNov. Each quarter new data is added to the data tab and a new row will need to be added to the table to represent this.</p>
<ol style="list-style-type: decimal">
<li>First, set up a dynamic count for the number of entries (i.e. number of quarters) in the data. In this example, we’ve set up a count in cell <code>H4</code> with the formula <code>COUNTA(DataNov!D1:IV1)</code> - this will count the number of non-blank cells in this range across columns within the sheet.</li>
</ol>
<p><img src="images/addtl-01-qtrcount.PNG" style="display: block; margin: auto;" />  </p>
<ol start="2" style="list-style-type: decimal">
<li>We then have to set two columns in our table to be formulas.</li>
</ol>
<ul>
<li>Column A - this is simple, we just have to increase the number by 1 for each new row.</li>
</ul>
<p><img src="images/addtl-02-cola.PNG" style="display: block; margin: auto;" />  </p>
<ul>
<li>Column B - in this column, the quater and year are named. So for this we will need to create a four column reference table (here, we right-clicked on <code>I</code> and clicked insert 4 times). The table we created looks like this with the formulas listed below.</li>
</ul>
<p><img src="images/addtl-03-colitol.PNG" style="display: block; margin: auto;" /></p>
<p><strong>Col I</strong> (Qtrs_from_Start) - this follows the same format as for Column A, except that we start the count at 0.</p>
<p><strong>Col J</strong> (Qtr-within_Year) - <code>=VLOOKUP(MOD(&lt;Qtrs_from_Start&gt;, 4), T$12:V$15, 2)</code>. This requires its own reference table for <code>T$12:V$15</code> which looks like this:</p>
<p><img src="images/addtl-04-colttov.PNG" style="display: block; margin: auto;" /></p>
<p><strong>Col K</strong> (Year) - <code>= &lt;Start Year&gt; + QUOTIENT(&lt;Qtrs_from_Start&gt;, 4)</code>. As an example, the first formula for <code>K11</code> will be <code>=2011 + QUOTIENT(I11, 4)</code>.</p>
<p><strong>Col L</strong> (Quarter) - <code>=CONCATENATE(&lt;Qtr_within_Year, &quot; &quot;, &lt;Year&gt;)</code>. As an example, the first formula for <code>L11</code> will be <code>=CONCATENATE(J11, &quot; &quot;, K11)</code>.</p>
<p>Finally, we can change our column B to be a formula. For this, we need to include a <code>p</code> (provisional) at the end of the final row in the table. The formula will look like this: <code>=&lt;Year&gt; &amp; IF(&lt;Quarters_of_Data+1), &quot;p&quot;, &quot;&quot;)</code>. The worked example is shown below:</p>
<p><img src="images/addtl-05-colb.PNG" style="display: block; margin: auto;" />  </p>
<ol start="3" style="list-style-type: decimal">
<li>The next step is to make quite a simple VBA script that checks if there are more quarters in our data tab that are in the table. If this is true then it copies the new data and inserts as the last row in our table. First, ensure Macros are enabled on your workbook (you may need to close and re-open the document), then click on the View tab and then select Macros. On the page that appears, enter the name of the Macro and click “Create”. Then, copy the code below. Once the Macro is set up, you can set up options to create a shortcut key to run the code without having to find it in the Macro menus.</li>
</ol>
<p><img src="images/addtl-06-viewmacro.PNG" style="display: block; margin: auto;" />   <img src="images/addtl-07-newmacro.PNG" style="display: block; margin: auto;" />  </p>
<pre><code>Sub CopyDataInsertLastLineOfTable()
&#39;
&#39; CopyDataInsertLastLineOfTable Macro
&#39;
&#39; Keyboard Shortcut: Ctrl+u
&#39;

&#39; If the number of quarters of data in the data tab is greater than the number of rows in the table,
&#39; then run the following code.
If Worksheets(&quot;Table1&quot;).Range(&quot;H4&quot;).Value &gt; Worksheets(&quot;Table1&quot;).Range(&quot;H5&quot;).Value Then 

        &#39; Find the last row in the table.
        &#39; The cell &quot;H5&quot; counts the current number of rows in the table while the +10 adjusts for
        &#39; the position of the first row.
        last_row_in_table = Worksheets(&quot;Table1&quot;).Range(&quot;H5&quot;).Value + 10
        
        &#39; Copy the last row in the table.
        Worksheets(&quot;Table1&quot;).Rows(last_row_in_table).Copy
        
        &#39; Select the row after the last row in the table.
        Rows((last_row_in_table + 1)).Select
        
        &#39; Insert the copied row right after the last row in the table.
        Select.Insert Shift:=x1Down, CopyOrigin:=xlFormatFromLeftOrAbove
        
End If

End Sub</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chart-baseline.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="title-auto-update.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
